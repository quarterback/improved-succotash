<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savings Calculator | Occupant</title>
    <meta name="description" content="Calculate how much you could save by optimizing your LLM model mix with Occupant Index pricing data.">
    <link rel="stylesheet" href="/styles.css">
    <style>
        /* Calculator-specific styles */
        .calculator-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .calc-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .calc-section h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--fg-dim);
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--fg);
            font-size: 0.875rem;
            font-family: inherit;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .workload-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .workload-option {
            padding: 1rem;
            border: 2px solid var(--border);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            background: var(--bg);
        }

        .workload-option:hover {
            border-color: var(--fg-dim);
        }

        .workload-option.selected {
            border-color: var(--accent);
            background: var(--accent-glow);
        }

        .workload-option .icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .workload-option .name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .workload-option .desc {
            font-size: 0.7rem;
            color: var(--fg-dim);
        }

        .calculate-btn {
            width: 100%;
            padding: 1rem;
            background: var(--accent);
            color: white;
            border: none;
            font-size: 0.875rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .calculate-btn:hover {
            opacity: 0.9;
        }

        .calculate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Results */
        .results-container {
            display: none;
        }

        .results-container.visible {
            display: block;
        }

        .savings-hero {
            text-align: center;
            padding: 2rem;
            background: var(--accent-glow);
            margin-bottom: 1.5rem;
        }

        .savings-amount {
            font-size: 3rem;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .savings-percent {
            font-size: 1rem;
            color: var(--fg-dim);
        }

        .cost-comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .cost-box {
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border);
        }

        .cost-box.current {
            background: rgba(255, 68, 68, 0.1);
            border-color: rgba(255, 68, 68, 0.3);
        }

        .cost-box.optimized {
            background: rgba(0, 255, 136, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
        }

        .cost-box .label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--fg-dim);
            margin-bottom: 0.5rem;
        }

        .cost-box .amount {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .cost-box.current .amount {
            color: var(--danger);
        }

        .cost-box.optimized .amount {
            color: var(--success);
        }

        .arrow {
            font-size: 1.5rem;
            color: var(--fg-dim);
        }

        .recommendations {
            margin-top: 1.5rem;
        }

        .rec-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 1rem;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .rec-item:last-child {
            border-bottom: none;
        }

        .rec-tier {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            background: var(--bg);
            border: 1px solid var(--border);
            font-weight: 600;
            color: var(--accent);
        }

        .rec-detail {
            font-size: 0.875rem;
        }

        .rec-detail .model {
            font-weight: 600;
        }

        .rec-detail .reason {
            color: var(--fg-dim);
            font-size: 0.75rem;
        }

        .rec-savings {
            font-weight: 600;
            color: var(--accent);
        }

        .methodology-note {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--bg);
            border: 1px solid var(--border);
            font-size: 0.75rem;
            color: var(--fg-dim);
        }

        .methodology-note a {
            color: var(--accent);
        }

        /* Tier breakdown */
        .tier-breakdown {
            margin-top: 1rem;
        }

        .tier-row {
            display: grid;
            grid-template-columns: 100px 1fr 80px 80px;
            gap: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
        }

        .tier-row.header {
            font-weight: 600;
            color: var(--fg-dim);
            font-size: 0.7rem;
            text-transform: uppercase;
        }

        .tier-row:last-child {
            border-bottom: none;
        }

        /* Advanced toggle */
        .advanced-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            color: var(--fg-dim);
            margin-top: 1rem;
        }

        .advanced-options {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .advanced-options.visible {
            display: block;
        }

        .annual-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            text-align: center;
        }

        .annual-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success);
        }

        .annual-label {
            font-size: 0.75rem;
            color: var(--fg-dim);
            margin-top: 0.25rem;
        }

        @media (max-width: 600px) {
            .input-row {
                grid-template-columns: 1fr;
            }

            .workload-selector {
                grid-template-columns: 1fr;
            }

            .cost-comparison {
                grid-template-columns: 1fr;
            }

            .arrow {
                transform: rotate(90deg);
                text-align: center;
            }

            .tier-row {
                grid-template-columns: 80px 1fr 60px;
            }

            .tier-row .tier-row:nth-child(4) {
                display: none;
            }

            .annual-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <a href="/">Index</a>
            <a href="/sabermetrics.html">Market Intel</a>
            <a href="/calculator.html" class="active">Calculator</a>
            <a href="/gov.html">Gov Benchmarks</a>
            <a href="/about.html">About</a>
            <div class="nav-right">
                <button id="theme-toggle" class="theme-toggle">Light</button>
            </div>
        </nav>

        <header>
            <h1>Savings Calculator</h1>
            <p class="subtitle">See how much you could save by optimizing your model mix</p>
        </header>

        <div class="calculator-container">
            <!-- Input Section -->
            <div class="calc-section">
                <h3>Your Current Usage</h3>

                <div class="input-row">
                    <div class="input-group">
                        <label for="monthly-spend">Monthly Spend ($)</label>
                        <input type="number" id="monthly-spend" placeholder="e.g., 5000" min="0">
                    </div>
                    <div class="input-group">
                        <label for="current-model">Primary Model</label>
                        <select id="current-model">
                            <option value="">Select your main model...</option>
                            <optgroup label="Frontier">
                                <option value="gpt-4o" data-price="7.50">GPT-4o ($7.50/MTok)</option>
                                <option value="gpt-5" data-price="4.81">GPT-5 ($4.81/MTok)</option>
                                <option value="claude-3.5-sonnet" data-price="9.00">Claude 3.5 Sonnet ($9.00/MTok)</option>
                                <option value="claude-3-opus" data-price="45.00">Claude 3 Opus ($45.00/MTok)</option>
                                <option value="gemini-1.5-pro" data-price="3.50">Gemini 1.5 Pro ($3.50/MTok)</option>
                                <option value="gemini-2.5-pro" data-price="3.50">Gemini 2.5 Pro ($3.50/MTok)</option>
                                <option value="grok-2" data-price="6.00">Grok 2 ($6.00/MTok)</option>
                                <option value="llama-3.1-405b" data-price="4.00">Llama 3.1 405B ($4.00/MTok)</option>
                            </optgroup>
                            <optgroup label="Reasoning">
                                <option value="o1" data-price="45.00">OpenAI o1 ($45.00/MTok)</option>
                                <option value="o1-mini" data-price="9.00">OpenAI o1-mini ($9.00/MTok)</option>
                                <option value="o3-mini" data-price="3.30">OpenAI o3-mini ($3.30/MTok)</option>
                                <option value="deepseek-r1" data-price="1.15">DeepSeek R1 ($1.15/MTok)</option>
                                <option value="claude-3.5-sonnet-thinking" data-price="12.00">Claude 3.5 Sonnet Thinking ($12.00/MTok)</option>
                                <option value="qwen-qwq" data-price="0.30">Qwen QwQ ($0.30/MTok)</option>
                            </optgroup>
                            <optgroup label="Mid-Tier">
                                <option value="gpt-4o-mini" data-price="0.45">GPT-4o-mini ($0.45/MTok)</option>
                                <option value="claude-3-haiku" data-price="0.75">Claude 3 Haiku ($0.75/MTok)</option>
                                <option value="deepseek-chat" data-price="0.53">DeepSeek V3 ($0.53/MTok)</option>
                                <option value="llama-3.1-70b" data-price="0.40">Llama 3.1 70B ($0.40/MTok)</option>
                                <option value="qwen-72b" data-price="0.56">Qwen 2.5 72B ($0.56/MTok)</option>
                                <option value="mistral-large" data-price="2.40">Mistral Large ($2.40/MTok)</option>
                                <option value="mistral-medium" data-price="0.81">Mistral Medium ($0.81/MTok)</option>
                            </optgroup>
                            <optgroup label="Budget">
                                <option value="gemini-flash" data-price="0.15">Gemini Flash ($0.15/MTok)</option>
                                <option value="gemini-2.0-flash" data-price="0.17">Gemini 2.0 Flash ($0.17/MTok)</option>
                                <option value="llama-3.1-8b" data-price="0.06">Llama 3.1 8B ($0.06/MTok)</option>
                                <option value="mistral-small" data-price="0.15">Mistral Small ($0.15/MTok)</option>
                                <option value="qwen-7b" data-price="0.05">Qwen 2.5 7B ($0.05/MTok)</option>
                                <option value="phi-3" data-price="0.08">Phi-3 ($0.08/MTok)</option>
                                <option value="gemma-2-9b" data-price="0.08">Gemma 2 9B ($0.08/MTok)</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <label class="advanced-toggle" onclick="toggleAdvanced()">
                    <span id="advanced-arrow">></span> Advanced: Enter token volume instead
                </label>

                <div class="advanced-options" id="advanced-options">
                    <div class="input-row">
                        <div class="input-group">
                            <label for="monthly-tokens">Monthly Tokens (millions)</label>
                            <input type="number" id="monthly-tokens" placeholder="e.g., 500" min="0">
                        </div>
                        <div class="input-group">
                            <label for="io-ratio">Input/Output Ratio</label>
                            <select id="io-ratio">
                                <option value="0.75">75/25 (typical chat)</option>
                                <option value="0.60">60/40 (generation-heavy)</option>
                                <option value="0.90">90/10 (RAG/retrieval)</option>
                                <option value="0.50">50/50 (balanced)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="calc-section">
                <h3>Your Workload Type</h3>
                <div class="workload-selector">
                    <div class="workload-option" data-workload="startup" onclick="selectWorkload(this)">
                        <div class="name">Startup Builder</div>
                        <div class="desc">Mixed tasks, cost-conscious</div>
                    </div>
                    <div class="workload-option" data-workload="agent" onclick="selectWorkload(this)">
                        <div class="name">Agentic Systems</div>
                        <div class="desc">Complex reasoning, tool use</div>
                    </div>
                    <div class="workload-option" data-workload="throughput" onclick="selectWorkload(this)">
                        <div class="name">High Throughput</div>
                        <div class="desc">Bulk processing, scale</div>
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculate()" id="calc-btn">
                Calculate Savings
            </button>

            <!-- Results Section -->
            <div class="results-container" id="results">
                <div class="calc-section">
                    <div class="savings-hero">
                        <div class="savings-amount" id="savings-amount">$0</div>
                        <div class="savings-percent" id="savings-percent">0% monthly savings</div>
                    </div>

                    <div class="cost-comparison">
                        <div class="cost-box current">
                            <div class="label">Current Cost</div>
                            <div class="amount" id="current-cost">$0</div>
                        </div>
                        <div class="arrow">-></div>
                        <div class="cost-box optimized">
                            <div class="label">Optimized Cost</div>
                            <div class="amount" id="optimized-cost">$0</div>
                        </div>
                    </div>
                </div>

                <div class="calc-section">
                    <h3>Recommended Model Mix</h3>
                    <p style="font-size: 0.875rem; color: var(--fg-dim); margin-bottom: 1rem;">
                        Based on your <span id="workload-name">workload</span> profile and current Occupant Index prices:
                    </p>

                    <div class="recommendations" id="recommendations">
                        <!-- Populated by JS -->
                    </div>

                    <div class="tier-breakdown">
                        <div class="tier-row header">
                            <span>Tier</span>
                            <span>Recommended Model</span>
                            <span>Price</span>
                            <span>Allocation</span>
                        </div>
                        <div id="tier-rows">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <div class="calc-section">
                    <h3>Annual Impact</h3>
                    <div class="annual-grid">
                        <div>
                            <div class="annual-value" id="annual-savings">$0</div>
                            <div class="annual-label">Projected Annual Savings</div>
                        </div>
                        <div>
                            <div class="annual-value" style="color: var(--fg);" id="tokens-saved">0M</div>
                            <div class="annual-label">More Tokens at Same Budget</div>
                        </div>
                    </div>
                </div>

                <div class="methodology-note">
                    <strong>Methodology:</strong> Savings calculated using current Occupant Index tier prices.
                    Workload allocations based on typical usage patterns: Startup (40% bulk, 40% general, 20% reasoning),
                    Agentic (20% bulk, 30% general, 50% reasoning), Throughput (70% bulk, 25% general, 5% reasoning).
                    Actual savings depend on your specific use case.
                    <a href="/about.html">Learn more about our methodology</a>
                </div>
            </div>
        </div>

        <footer>
            <div class="footer-links">
                <a href="/about.html">About</a>
                <a href="https://github.com/quarterback/occupant">GitHub</a>
                <a href="mailto:hello@occupant.ee">Contact</a>
            </div>
            <div class="last-updated">
                Last updated: <span id="last-updated">-</span>
            </div>
            <p style="margin-top: 1rem; font-size: 0.625rem; color: var(--fg-dim);">2025-2026 Occupant Index</p>
        </footer>
    </div>

    <script src="/theme.js"></script>
    <script>
        // Current tier prices from Occupant Index
        const tierPrices = {
            bulk: { price: 0.61, model: 'Gemini Flash', modelId: 'gemini-flash' },
            general: { price: 4.59, model: 'GPT-4o-mini', modelId: 'gpt-4o-mini' },
            frontier: { price: 10.04, model: 'Claude 3.5 Sonnet', modelId: 'claude-3.5-sonnet' },
            reasoning: { price: 7.92, model: 'DeepSeek R1', modelId: 'deepseek-r1' }
        };

        // Workload profiles (allocation percentages)
        const workloadProfiles = {
            startup: {
                name: 'Startup Builder',
                bulk: 0.40,
                general: 0.40,
                frontier: 0.10,
                reasoning: 0.10
            },
            agent: {
                name: 'Agentic Systems',
                bulk: 0.15,
                general: 0.25,
                frontier: 0.10,
                reasoning: 0.50
            },
            throughput: {
                name: 'High Throughput',
                bulk: 0.70,
                general: 0.20,
                frontier: 0.05,
                reasoning: 0.05
            }
        };

        let selectedWorkload = null;

        function selectWorkload(element) {
            document.querySelectorAll('.workload-option').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedWorkload = element.dataset.workload;
        }

        function toggleAdvanced() {
            const options = document.getElementById('advanced-options');
            const arrow = document.getElementById('advanced-arrow');
            options.classList.toggle('visible');
            arrow.textContent = options.classList.contains('visible') ? 'v' : '>';
        }

        function calculate() {
            const monthlySpend = parseFloat(document.getElementById('monthly-spend').value) || 0;
            const currentModelSelect = document.getElementById('current-model');
            const currentModelPrice = parseFloat(currentModelSelect.selectedOptions[0]?.dataset?.price) || 0;

            if (!monthlySpend || !selectedWorkload) {
                alert('Please enter your monthly spend and select a workload type.');
                return;
            }

            const profile = workloadProfiles[selectedWorkload];

            // Calculate current cost (already provided)
            const currentCost = monthlySpend;

            // Estimate token volume from spend
            const estimatedTokens = currentModelPrice > 0 ? (monthlySpend / currentModelPrice) * 1000000 : 0;

            // Calculate optimized cost using tier prices and workload allocation
            let optimizedCost = 0;
            const tierAllocations = [];

            for (const [tier, allocation] of Object.entries({
                bulk: profile.bulk,
                general: profile.general,
                frontier: profile.frontier,
                reasoning: profile.reasoning
            })) {
                const tierTokens = estimatedTokens * allocation;
                const tierCost = (tierTokens / 1000000) * tierPrices[tier].price;
                optimizedCost += tierCost;

                tierAllocations.push({
                    tier: tier,
                    allocation: allocation,
                    tokens: tierTokens,
                    cost: tierCost,
                    model: tierPrices[tier].model,
                    price: tierPrices[tier].price
                });
            }

            // Calculate savings
            const savings = currentCost - optimizedCost;
            const savingsPercent = currentCost > 0 ? (savings / currentCost) * 100 : 0;
            const annualSavings = savings * 12;

            // Calculate additional tokens possible
            const avgOptimizedPrice = optimizedCost / (estimatedTokens / 1000000);
            const additionalTokens = avgOptimizedPrice > 0 ? (savings / avgOptimizedPrice) * 1000000 : 0;

            // Update UI
            document.getElementById('savings-amount').textContent = formatCurrency(Math.max(0, savings));
            document.getElementById('savings-percent').textContent = `${Math.max(0, savingsPercent).toFixed(1)}% monthly savings`;
            document.getElementById('current-cost').textContent = formatCurrency(currentCost);
            document.getElementById('optimized-cost').textContent = formatCurrency(Math.max(0, optimizedCost));
            document.getElementById('annual-savings').textContent = formatCurrency(Math.max(0, annualSavings));
            document.getElementById('tokens-saved').textContent = formatTokens(Math.max(0, additionalTokens));
            document.getElementById('workload-name').textContent = profile.name;

            // Build tier rows
            const tierRowsHtml = tierAllocations.map(t => `
                <div class="tier-row">
                    <span style="color: var(--accent);">$${t.tier.toUpperCase()}</span>
                    <span>${t.model}</span>
                    <span>$${t.price.toFixed(2)}</span>
                    <span>${(t.allocation * 100).toFixed(0)}%</span>
                </div>
            `).join('');
            document.getElementById('tier-rows').innerHTML = tierRowsHtml;

            // Build recommendations
            const recsHtml = tierAllocations
                .filter(t => t.allocation > 0)
                .sort((a, b) => b.allocation - a.allocation)
                .map(t => `
                    <div class="rec-item">
                        <span class="rec-tier">$${t.tier.toUpperCase()}</span>
                        <div class="rec-detail">
                            <div class="model">${t.model}</div>
                            <div class="reason">${(t.allocation * 100).toFixed(0)}% of workload -> ${formatCurrency(t.cost)}/mo</div>
                        </div>
                        <span class="rec-savings">$${t.price.toFixed(2)}/MTok</span>
                    </div>
                `).join('');
            document.getElementById('recommendations').innerHTML = recsHtml;

            // Show results
            document.getElementById('results').classList.add('visible');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function formatCurrency(amount) {
            if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(1) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(1) + 'K';
            }
            return '$' + amount.toFixed(0);
        }

        function formatTokens(tokens) {
            if (tokens >= 1000000000) {
                return (tokens / 1000000000).toFixed(1) + 'B';
            } else if (tokens >= 1000000) {
                return (tokens / 1000000).toFixed(1) + 'M';
            } else if (tokens >= 1000) {
                return (tokens / 1000).toFixed(1) + 'K';
            }
            return tokens.toFixed(0);
        }

        // Load current prices from Occupant data
        async function loadPrices() {
            try {
                const response = await fetch('/data/compute-cpi.json');
                const data = await response.json();

                if (data.subindices) {
                    if (data.subindices.budget) tierPrices.bulk.price = data.subindices.budget.value;
                    if (data.subindices.frontier) tierPrices.frontier.price = data.subindices.frontier.value;
                    if (data.subindices.judgment) tierPrices.reasoning.price = data.subindices.judgment.value;
                }

                if (data.meta && data.meta.generated_at) {
                    document.getElementById('last-updated').textContent = new Date(data.meta.generated_at).toISOString().split('T')[0];
                }
            } catch (e) {
                console.log('Using default prices');
            }
        }

        loadPrices();
    </script>
</body>
</html>
