<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Intelligence | Occupant</title>
    <meta name="description" content="LLM market intelligence - Quality-Adjusted Price, Cognitive Arbitrage, and tier analysis.">
    <link rel="stylesheet" href="/styles.css">
    <style>
        .headline {
            background: var(--accent-glow);
            border-left: 3px solid var(--accent);
            padding: 1rem 1.25rem;
            margin-bottom: 2rem;
            font-size: 0.95rem;
            color: var(--fg);
        }
        .pulse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .pulse-item {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 1rem;
        }
        .pulse-label {
            font-size: 0.7rem;
            color: var(--fg-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .pulse-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--fg);
        }
        .pulse-detail {
            font-size: 0.75rem;
            color: var(--fg-muted);
            margin-top: 0.25rem;
        }
        .provider-bar {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }
        .provider-tag {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 3px;
        }
        .provider-tag .pct {
            color: var(--accent);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <a href="/">Index</a>
            <a href="/sabermetrics.html" class="active">Market Intel</a>
            <a href="/calculator.html">Calculator</a>
            <a href="/gov.html">Gov Benchmarks</a>
            <a href="/about.html">About</a>
            <div class="nav-right">
                <button id="theme-toggle" class="theme-toggle">Light</button>
            </div>
        </nav>

        <header>
            <h1>Market Intelligence</h1>
            <p class="subtitle">Statistics that reprice market assumptions</p>
        </header>

        <!-- Headline Insight -->
        <div class="headline" id="headline">
            Loading market intelligence...
        </div>

        <!-- Market Pulse -->
        <section class="card">
            <div class="section-header">
                <div class="section-title">Market Pulse</div>
            </div>
            <div class="pulse-grid">
                <div class="pulse-item">
                    <div class="pulse-label">Models Tracked</div>
                    <div class="pulse-value" id="models-count">-</div>
                </div>
                <div class="pulse-item">
                    <div class="pulse-label">Judgment Share</div>
                    <div class="pulse-value" id="judgment-share">-</div>
                    <div class="pulse-detail">% volume to reasoning models</div>
                </div>
                <div class="pulse-item">
                    <div class="pulse-label">Top Providers</div>
                    <div class="provider-bar" id="provider-bar">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Build Cost Index -->
        <section class="persona-cpis card">
            <div class="section-header">
                <div class="section-title">Build Cost Index</div>
                <div class="section-subtitle">What does YOUR workload cost?</div>
            </div>
            <div class="persona-grid">
                <div class="persona-card">
                    <div class="persona-ticker">$START</div>
                    <div class="persona-value" id="startup-cpi">-</div>
                    <div class="persona-name">Startup Builder</div>
                    <div class="persona-change" id="startup-change">-</div>
                    <div class="persona-insight" id="startup-insight"></div>
                </div>
                <div class="persona-card">
                    <div class="persona-ticker">$AGENT</div>
                    <div class="persona-value" id="agentic-cpi">-</div>
                    <div class="persona-name">Agentic Team</div>
                    <div class="persona-change" id="agentic-change">-</div>
                    <div class="persona-insight" id="agentic-insight"></div>
                </div>
                <div class="persona-card">
                    <div class="persona-ticker">$THRU</div>
                    <div class="persona-value" id="throughput-cpi">-</div>
                    <div class="persona-name">Throughput</div>
                    <div class="persona-change" id="throughput-change">-</div>
                    <div class="persona-insight" id="throughput-insight"></div>
                </div>
            </div>
        </section>

        <!-- Trend Analysis -->
        <section class="trend-analysis card">
            <div class="section-header">
                <div class="section-title">Trend</div>
            </div>
            <div class="trend-grid">
                <div class="trend-item">
                    <div class="trend-label">Direction</div>
                    <div class="trend-value" id="trend-direction">-</div>
                </div>
                <div class="trend-item">
                    <div class="trend-label">Velocity</div>
                    <div class="trend-value" id="trend-velocity">-</div>
                    <div class="trend-unit">pts/month</div>
                </div>
                <div class="trend-item">
                    <div class="trend-label">30d Forecast</div>
                    <div class="trend-value" id="trend-forecast">-</div>
                </div>
                <div class="trend-item">
                    <div class="trend-label">Confidence</div>
                    <div class="trend-value" id="trend-confidence">-</div>
                </div>
            </div>
        </section>

        <!-- Basket Detail -->
        <section class="basket-detail card">
            <div class="section-header">
                <div class="section-title">Cost Breakdown by Workload</div>
                <div class="section-subtitle">Per 1K workloads</div>
            </div>
            <div class="basket-grid">
                <div class="basket-item">
                    <div class="basket-label">Chat Drafting</div>
                    <div class="basket-value" id="basket-chat">-</div>
                    <div class="basket-weight" id="basket-chat-weight">-</div>
                </div>
                <div class="basket-item">
                    <div class="basket-label">Summarization</div>
                    <div class="basket-value" id="basket-summarization">-</div>
                    <div class="basket-weight" id="basket-summarization-weight">-</div>
                </div>
                <div class="basket-item">
                    <div class="basket-label">Classification</div>
                    <div class="basket-value" id="basket-classification">-</div>
                    <div class="basket-weight" id="basket-classification-weight">-</div>
                </div>
                <div class="basket-item">
                    <div class="basket-label">Coding</div>
                    <div class="basket-value" id="basket-coding">-</div>
                    <div class="basket-weight" id="basket-coding-weight">-</div>
                </div>
                <div class="basket-item">
                    <div class="basket-label">Judgment</div>
                    <div class="basket-value" id="basket-judgment">-</div>
                    <div class="basket-weight" id="basket-judgment-weight">-</div>
                </div>
                <div class="basket-item">
                    <div class="basket-label">Long Context</div>
                    <div class="basket-value" id="basket-longctx">-</div>
                    <div class="basket-weight" id="basket-longctx-weight">-</div>
                </div>
            </div>
        </section>

        <!-- Spreads -->
        <section class="spreads card">
            <div class="section-header">
                <div class="section-title">Tier Premiums</div>
                <div class="section-subtitle">Cost differentials between capability tiers</div>
            </div>
            <div class="spreads-grid">
                <div class="spread-item">
                    <div class="spread-ticker">$COG-P</div>
                    <div class="spread-value" id="spread-cognition">-</div>
                    <div class="spread-name">Cognition Premium</div>
                    <div class="spread-desc">Frontier vs Budget</div>
                </div>
                <div class="spread-item">
                    <div class="spread-ticker">$JDG-P</div>
                    <div class="spread-value" id="spread-judgment">-</div>
                    <div class="spread-name">Judgment Premium</div>
                    <div class="spread-desc">Reasoning vs Frontier</div>
                </div>
                <div class="spread-item">
                    <div class="spread-ticker">$CTX-P</div>
                    <div class="spread-value" id="spread-context">-</div>
                    <div class="spread-name">Context Premium</div>
                    <div class="spread-desc">Long context capability</div>
                </div>
            </div>
        </section>

        <!-- Exchange Rates -->
        <section class="exchange-rates card">
            <div class="section-header">
                <div class="section-title">Token Exchange Rates</div>
                <div class="section-subtitle">Base: <span id="exchange-base">-</span></div>
            </div>
            <div class="exchange-grid">
                <div class="exchange-item">
                    <div class="exchange-ticker">$FRONT</div>
                    <div class="exchange-rate" id="exchange-frontier">-</div>
                    <div class="exchange-display" id="exchange-frontier-display">-</div>
                </div>
                <div class="exchange-item">
                    <div class="exchange-ticker">$REASON</div>
                    <div class="exchange-rate" id="exchange-reasoning">-</div>
                    <div class="exchange-display" id="exchange-reasoning-display">-</div>
                </div>
                <div class="exchange-item">
                    <div class="exchange-ticker">$LCTX</div>
                    <div class="exchange-rate" id="exchange-longctx">-</div>
                    <div class="exchange-display" id="exchange-longctx-display">-</div>
                </div>
                <div class="exchange-item">
                    <div class="exchange-ticker">$BULK</div>
                    <div class="exchange-rate" id="exchange-budget">-</div>
                    <div class="exchange-display" id="exchange-budget-display">-</div>
                </div>
            </div>
        </section>

        <!-- Index Series -->
        <section class="index-series card">
            <div class="section-header">
                <div class="section-title">Index Series</div>
                <div class="section-subtitle">Different time horizons</div>
            </div>
            <div class="series-grid">
                <div class="series-item">
                    <div class="series-ticker">$CPI-L</div>
                    <div class="series-value" id="series-launch">-</div>
                    <div class="series-name">Since Launch</div>
                    <div class="series-date" id="series-launch-date">-</div>
                </div>
                <div class="series-item">
                    <div class="series-ticker">$CPI-Y</div>
                    <div class="series-value" id="series-yoy">-</div>
                    <div class="series-name">Year-over-Year</div>
                    <div class="series-date" id="series-yoy-date">-</div>
                </div>
                <div class="series-item">
                    <div class="series-ticker">$CPI-Q</div>
                    <div class="series-value" id="series-qtd">-</div>
                    <div class="series-name">Quarter-to-Date</div>
                    <div class="series-date" id="series-qtd-date">-</div>
                </div>
            </div>
        </section>

        <!-- Methodology Variants -->
        <section class="methodology-variants card">
            <div class="section-header">
                <div class="section-title">Methodology Variants</div>
                <div class="section-subtitle">Different workload profiles</div>
            </div>
            <div class="variants-grid">
                <div class="variant-item">
                    <div class="variant-ticker">$CPI-GEN</div>
                    <div class="variant-value" id="variant-general">-</div>
                    <div class="variant-name">General Purpose</div>
                    <div class="variant-desc">Balanced mix</div>
                </div>
                <div class="variant-item">
                    <div class="variant-ticker">$CPI-FRO</div>
                    <div class="variant-value" id="variant-frontier">-</div>
                    <div class="variant-name">Frontier Heavy</div>
                    <div class="variant-desc">High capability</div>
                </div>
                <div class="variant-item">
                    <div class="variant-ticker">$CPI-BUD</div>
                    <div class="variant-value" id="variant-budget">-</div>
                    <div class="variant-name">Budget Optimized</div>
                    <div class="variant-desc">Cost conscious</div>
                </div>
                <div class="variant-item">
                    <div class="variant-ticker">$CPI-REA</div>
                    <div class="variant-value" id="variant-reasoning">-</div>
                    <div class="variant-name">Reasoning Focus</div>
                    <div class="variant-desc">Complex tasks</div>
                </div>
                <div class="variant-item">
                    <div class="variant-ticker">$CPI-ENT</div>
                    <div class="variant-value" id="variant-enterprise">-</div>
                    <div class="variant-name">Enterprise Mix</div>
                    <div class="variant-desc">Automation workloads</div>
                </div>
            </div>
        </section>

        <!-- Yield Curve -->
        <section class="yield-curve card">
            <div class="section-header">
                <div class="section-title">Yield Curve</div>
                <div class="section-subtitle">Deflation rates by time horizon</div>
            </div>
            <div class="yield-grid">
                <div class="yield-item">
                    <div class="yield-period">1M</div>
                    <div class="yield-deflation" id="yield-1m">-</div>
                    <div class="yield-annualized" id="yield-1m-ann">-</div>
                </div>
                <div class="yield-item">
                    <div class="yield-period">3M</div>
                    <div class="yield-deflation" id="yield-3m">-</div>
                    <div class="yield-annualized" id="yield-3m-ann">-</div>
                </div>
                <div class="yield-item">
                    <div class="yield-period">6M</div>
                    <div class="yield-deflation" id="yield-6m">-</div>
                    <div class="yield-annualized" id="yield-6m-ann">-</div>
                </div>
                <div class="yield-item">
                    <div class="yield-period">1Y</div>
                    <div class="yield-deflation" id="yield-1y">-</div>
                    <div class="yield-annualized" id="yield-1y-ann">-</div>
                </div>
            </div>
            <p style="margin-top: 1rem; font-size: 0.75rem; color: var(--fg-muted);" id="yield-interpretation">-</p>
        </section>

        <!-- Tier Analysis -->
        <section class="card">
            <div class="section-header">
                <div class="section-title">Tier Analysis</div>
                <div class="section-subtitle">Average price and quality by tier</div>
            </div>
            <div class="tier-grid" id="tier-grid">
                <!-- Populated by JS -->
            </div>
        </section>

        <!-- Arbitrage Opportunities -->
        <section class="card">
            <div class="section-header">
                <div class="section-title">Cognitive Arbitrage</div>
                <div class="section-subtitle">Models priced above or below capability (>1.2 = underpriced, <0.8 = overpriced)</div>
            </div>
            <table class="leaders-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Arbitrage</th>
                        <th>Signal</th>
                        <th>Price</th>
                        <th>ELO</th>
                    </tr>
                </thead>
                <tbody id="arbitrage-table">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </section>

        <!-- Value Leaders -->
        <section class="card">
            <div class="section-header">
                <div class="section-title">Value Leaders</div>
                <div class="section-subtitle">Lowest Quality-Adjusted Price (QAP = price / quality)</div>
            </div>
            <table class="leaders-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>QAP</th>
                        <th>Price</th>
                        <th>ELO</th>
                    </tr>
                </thead>
                <tbody id="value-table">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </section>

        <!-- Rankings Data -->
        <section class="card">
            <div class="section-header">
                <div class="section-title">Market Volume</div>
                <div class="section-subtitle">Weekly token volume from OpenRouter</div>
            </div>
            <table class="leaders-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Volume</th>
                        <th>Share</th>
                    </tr>
                </thead>
                <tbody id="volume-table">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </section>

        <footer>
            <div>Data from OpenRouter, Arena Leaderboard</div>
            <div style="margin-top: 1rem;">
                <a href="/glossary.html">What do these metrics mean?</a>
            </div>
        </footer>
    </div>

    <script src="/theme.js"></script>
    <script>
        // Format model name for display
        function formatModelName(modelId) {
            if (!modelId) return 'Unknown';

            // Use model_name if available, otherwise format from ID
            const name = modelId.split('/').pop();

            // Clean up common patterns
            return name
                .replace(/-/g, ' ')
                .replace(/_/g, ' ')
                .split(' ')
                .map(word => {
                    // Keep version numbers as-is
                    if (/\d/.test(word)) return word;
                    return word.charAt(0).toUpperCase() + word.slice(1);
                })
                .join(' ');
        }

        async function loadMarketData() {
            try {
                const response = await fetch('/data/market/latest.json');
                const data = await response.json();

                // Headline
                if (data.headline) {
                    document.getElementById('headline').textContent = data.headline;
                }

                // Summary stats
                document.getElementById('models-count').textContent = data.models_analyzed || '-';

                // Judgment share
                if (data.market_pulse && data.market_pulse.judgment_share !== null) {
                    document.getElementById('judgment-share').textContent = data.market_pulse.judgment_share + '%';
                }

                // Provider concentration
                if (data.market_pulse && data.market_pulse.provider_concentration) {
                    const providerBar = document.getElementById('provider-bar');
                    providerBar.innerHTML = '';

                    for (const [provider, pct] of Object.entries(data.market_pulse.provider_concentration)) {
                        const tag = document.createElement('span');
                        tag.className = 'provider-tag';
                        tag.innerHTML = `${provider}: <span class="pct">${pct}%</span>`;
                        providerBar.appendChild(tag);
                    }
                }

                // Tier analysis
                const tierGrid = document.getElementById('tier-grid');
                tierGrid.innerHTML = '';

                const tierOrder = ['budget', 'general', 'frontier', 'reasoning', 'longctx'];
                const tierLabels = {
                    'budget': '$BULK',
                    'general': '$GEN',
                    'frontier': '$FRONT',
                    'reasoning': '$REASON',
                    'longctx': '$LCTX'
                };

                const maxPrice = Math.max(...Object.values(data.tier_analysis || {}).map(t => t.avg_price_mtok || 0));

                for (const tier of tierOrder) {
                    if (data.tier_analysis && data.tier_analysis[tier]) {
                        const t = data.tier_analysis[tier];
                        const barWidth = maxPrice > 0 ? (t.avg_price_mtok / maxPrice) * 100 : 0;

                        const row = document.createElement('div');
                        row.className = 'tier-row';
                        row.innerHTML = `
                            <div class="tier-name">${tierLabels[tier] || tier}</div>
                            <div class="tier-bar"><div class="tier-bar-fill" style="width: ${barWidth}%"></div></div>
                            <div class="tier-price">$${t.avg_price_mtok.toFixed(2)}/MTok</div>
                            <div class="tier-elo">ELO ${t.avg_elo || '-'}</div>
                        `;
                        tierGrid.appendChild(row);
                    }
                }

                // Arbitrage table
                const arbTable = document.getElementById('arbitrage-table');
                arbTable.innerHTML = '';

                for (const a of (data.arbitrage_opportunities || [])) {
                    const signalClass = a.arbitrage > 1.2 ? 'buy' : a.arbitrage < 0.8 ? 'sell' : 'fair';
                    const signalText = a.arbitrage > 1.2 ? 'BUY' : a.arbitrage < 0.8 ? 'SELL' : 'FAIR';
                    const displayName = a.model_name || formatModelName(a.model);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="model-name">${displayName}</td>
                        <td class="value-cell">${a.arbitrage.toFixed(2)}</td>
                        <td><span class="signal ${signalClass}">${signalText}</span></td>
                        <td class="value-cell">$${a.blended_cost.toFixed(2)}</td>
                        <td class="value-cell">${a.arena_elo || '-'}</td>
                    `;
                    arbTable.appendChild(row);
                }

                // Value leaders table
                const valueTable = document.getElementById('value-table');
                valueTable.innerHTML = '';

                for (const v of (data.value_leaders || [])) {
                    const displayName = v.model_name || formatModelName(v.model);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="model-name">${displayName}</td>
                        <td class="value-cell">${v.qap.toFixed(2)}</td>
                        <td class="value-cell">$${v.blended_cost.toFixed(2)}/MTok</td>
                        <td class="value-cell">${v.arena_elo || '-'}</td>
                    `;
                    valueTable.appendChild(row);
                }


            } catch (error) {
                console.log('Market data not available:', error);
                document.getElementById('headline').textContent = 'Market data loading...';
            }
        }

        async function loadRankingsData() {
            try {
                const response = await fetch('/data/rankings/latest.json');
                const data = await response.json();

                const volumeTable = document.getElementById('volume-table');
                volumeTable.innerHTML = '';

                if (data.models) {
                    // Sort by volume
                    const sorted = Object.entries(data.models)
                        .sort((a, b) => b[1].tokens_weekly - a[1].tokens_weekly)
                        .slice(0, 10);

                    for (const [model, info] of sorted) {
                        const displayName = formatModelName(model);

                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="model-name">${displayName}</td>
                            <td class="value-cell">${info.tokens_formatted}</td>
                            <td class="value-cell">${info.market_share_pct.toFixed(1)}%</td>
                        `;
                        volumeTable.appendChild(row);
                    }
                }
            } catch (error) {
                console.log('Rankings data not available:', error);
            }
        }

        async function loadCPIData() {
            try {
                const response = await fetch('/data/compute-cpi.json');
                const data = await response.json();

                // Persona CPIs
                if (data.persona_cpis) {
                    const personas = data.persona_cpis;

                    if (personas.startup) {
                        document.getElementById('startup-cpi').textContent = personas.startup.cpi.toFixed(1);
                        const startupChange = document.getElementById('startup-change');
                        if (personas.startup.mom_change !== null) {
                            startupChange.textContent = (personas.startup.mom_change >= 0 ? '+' : '') + personas.startup.mom_change.toFixed(1) + '% MoM';
                            if (personas.startup.mom_change < 0) startupChange.classList.add('negative');
                        } else {
                            startupChange.textContent = 'Benchmarking';
                        }
                        document.getElementById('startup-insight').textContent = personas.startup.insight;
                    }

                    if (personas.agentic) {
                        document.getElementById('agentic-cpi').textContent = personas.agentic.cpi.toFixed(1);
                        const agenticChange = document.getElementById('agentic-change');
                        if (personas.agentic.mom_change !== null) {
                            agenticChange.textContent = (personas.agentic.mom_change >= 0 ? '+' : '') + personas.agentic.mom_change.toFixed(1) + '% MoM';
                            if (personas.agentic.mom_change < 0) agenticChange.classList.add('negative');
                        } else {
                            agenticChange.textContent = 'Benchmarking';
                        }
                        document.getElementById('agentic-insight').textContent = personas.agentic.insight;
                    }

                    if (personas.throughput) {
                        document.getElementById('throughput-cpi').textContent = personas.throughput.cpi.toFixed(1);
                        const throughputChange = document.getElementById('throughput-change');
                        if (personas.throughput.mom_change !== null) {
                            throughputChange.textContent = (personas.throughput.mom_change >= 0 ? '+' : '') + personas.throughput.mom_change.toFixed(1) + '% MoM';
                            if (personas.throughput.mom_change < 0) throughputChange.classList.add('negative');
                        } else {
                            throughputChange.textContent = 'Benchmarking';
                        }
                        document.getElementById('throughput-insight').textContent = personas.throughput.insight;
                    }
                }

                // Trend Analysis
                if (data.trend_analysis) {
                    const trend = data.trend_analysis;
                    const directionEl = document.getElementById('trend-direction');
                    const directionSymbol = trend.direction === 'deflating' ? '↓' : trend.direction === 'inflating' ? '↑' : '→';
                    directionEl.textContent = directionSymbol + ' ' + trend.direction.toUpperCase();
                    if (trend.direction === 'deflating') directionEl.classList.add('deflating');
                    if (trend.direction === 'inflating') directionEl.classList.add('inflating');

                    const velocityEl = document.getElementById('trend-velocity');
                    velocityEl.textContent = (trend.velocity >= 0 ? '+' : '') + trend.velocity.toFixed(2);

                    document.getElementById('trend-forecast').textContent = trend.forecast_30d.toFixed(1);
                    document.getElementById('trend-confidence').textContent = trend.confidence.toUpperCase();
                }

                // Basket Detail
                if (data.basket_detail) {
                    const basket = data.basket_detail;
                    document.getElementById('basket-chat').textContent = '$' + basket.chat_drafting.cost.toFixed(2);
                    document.getElementById('basket-chat-weight').textContent = (basket.chat_drafting.weight * 100) + '% weight';

                    document.getElementById('basket-summarization').textContent = '$' + basket.summarization.cost.toFixed(2);
                    document.getElementById('basket-summarization-weight').textContent = (basket.summarization.weight * 100) + '% weight';

                    document.getElementById('basket-classification').textContent = '$' + basket.classification.cost.toFixed(2);
                    document.getElementById('basket-classification-weight').textContent = (basket.classification.weight * 100) + '% weight';

                    document.getElementById('basket-coding').textContent = '$' + basket.coding.cost.toFixed(2);
                    document.getElementById('basket-coding-weight').textContent = (basket.coding.weight * 100) + '% weight';

                    document.getElementById('basket-judgment').textContent = '$' + basket.judgment.cost.toFixed(2);
                    document.getElementById('basket-judgment-weight').textContent = (basket.judgment.weight * 100) + '% weight';

                    document.getElementById('basket-longctx').textContent = '$' + basket.long_context.cost.toFixed(2);
                    document.getElementById('basket-longctx-weight').textContent = (basket.long_context.weight * 100) + '% weight';
                }

                // Spreads
                if (data.spreads) {
                    const spreads = data.spreads;
                    const cogValue = spreads.cognition_premium.value;
                    const jdgValue = spreads.judgment_premium.value;
                    const ctxValue = spreads.context_premium.value;

                    document.getElementById('spread-cognition').textContent = (cogValue >= 0 ? '+' : '') + '$' + cogValue.toFixed(2);
                    document.getElementById('spread-judgment').textContent = (jdgValue >= 0 ? '+' : '') + '$' + jdgValue.toFixed(2);
                    document.getElementById('spread-context').textContent = (ctxValue >= 0 ? '+' : '') + '$' + ctxValue.toFixed(2);
                }

                // Exchange Rates
                if (data.exchange_rates) {
                    const ex = data.exchange_rates;
                    document.getElementById('exchange-base').textContent = ex.base.ticker + ' (' + ex.base.name + ')';

                    const rates = ex.rates;
                    document.getElementById('exchange-frontier').textContent = rates.frontier.rate + 'x';
                    document.getElementById('exchange-frontier-display').textContent = rates.frontier.display;

                    document.getElementById('exchange-reasoning').textContent = rates.reasoning.rate + 'x';
                    document.getElementById('exchange-reasoning-display').textContent = rates.reasoning.display;

                    document.getElementById('exchange-longctx').textContent = rates.longctx.rate + 'x';
                    document.getElementById('exchange-longctx-display').textContent = rates.longctx.display;

                    document.getElementById('exchange-budget').textContent = rates.budget.rate + 'x';
                    document.getElementById('exchange-budget-display').textContent = rates.budget.display;
                }

                // Index Series
                if (data.index_series) {
                    const series = data.index_series;
                    document.getElementById('series-launch').textContent = series.launch.value.toFixed(1);
                    document.getElementById('series-launch-date').textContent = 'Base: ' + series.launch.base_date;

                    document.getElementById('series-yoy').textContent = series.yoy.value.toFixed(1);
                    document.getElementById('series-yoy-date').textContent = 'Base: ' + series.yoy.base_date;

                    document.getElementById('series-qtd').textContent = series.qtd.value.toFixed(1);
                    document.getElementById('series-qtd-date').textContent = 'Base: ' + series.qtd.base_date;
                }

                // Methodology Variants
                if (data.methodology_variants) {
                    const variants = data.methodology_variants;
                    document.getElementById('variant-general').textContent = variants.general.value.toFixed(1);
                    document.getElementById('variant-frontier').textContent = variants.frontier_heavy.value.toFixed(1);
                    document.getElementById('variant-budget').textContent = variants.budget_heavy.value.toFixed(1);
                    document.getElementById('variant-reasoning').textContent = variants.reasoning_focus.value.toFixed(1);
                    document.getElementById('variant-enterprise').textContent = variants.enterprise.value.toFixed(1);
                }

                // Yield Curve
                if (data.yield_curve) {
                    const curve = data.yield_curve.curve;
                    document.getElementById('yield-1m').textContent = curve['1m'].deflation_pct.toFixed(2) + '%';
                    document.getElementById('yield-1m-ann').textContent = curve['1m'].annualized_pct.toFixed(2) + '% annualized';

                    document.getElementById('yield-3m').textContent = curve['3m'].deflation_pct.toFixed(2) + '%';
                    document.getElementById('yield-3m-ann').textContent = curve['3m'].annualized_pct.toFixed(2) + '% annualized';

                    document.getElementById('yield-6m').textContent = curve['6m'].deflation_pct.toFixed(2) + '%';
                    document.getElementById('yield-6m-ann').textContent = curve['6m'].annualized_pct.toFixed(2) + '% annualized';

                    document.getElementById('yield-1y').textContent = curve['1y'].deflation_pct.toFixed(2) + '%';
                    document.getElementById('yield-1y-ann').textContent = curve['1y'].annualized_pct.toFixed(2) + '% annualized';

                    document.getElementById('yield-interpretation').textContent = data.yield_curve.interpretation;
                }

            } catch (error) {
                console.log('CPI data not yet available');
            }
        }

        loadMarketData();
        loadRankingsData();
        loadCPIData();
    </script>
</body>
</html>
